var ooSearch={markers:[],map:{},records:[],init:function(){Array.prototype.indexOf||(Array.prototype.indexOf=function(a){var b=this.length>>>0,c=Number(arguments[1])||0;for(c=0>c?Math.ceil(c):Math.floor(c),0>c&&(c+=b);b>c;c++)if(c in this&&this[c]===a)return c;return-1}),this.searchContainer=$("div.oo-container"),this.searchButton=$("button.oo-search"),this.searchResultsArea=$("div.oo-output"),this.searchAgainButton=$("button.oo-search-again"),this.searchInputs=$("input.oo-input"),ooSearch.loadMap()},loadMap:function(){var a=[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]}];ooSearch.map=new google.maps.Map(document.getElementById("oo-map"),{zoom:10,center:new google.maps.LatLng(51.2088793,.4261792),mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:!0,styles:a,scrollwheel:!1})},bindEvents:function(a){var b=ooSearch;return function(){if(b.clearInfoWindows(),this.getAnimation())this.setAnimation(null),b.markers[a].infoWindow.close();else{b.stopMarkerAnimation(),this.setAnimation(google.maps.Animation.BOUNCE),b.markers[a].infoWindow.open(b.map,b.markers[a].marker);for(var c=!1,d=0;d<b.records.length;d+=1)b.records[d].coordinatesUniqueId===b.markers[a].uniqueId&&($(".oo-venue-title").not(b.records[d].div.parent().siblings(".oo-venue-title")).each(function(){"true"!==$(this).attr("data-hidden")&&$(this).click()}),"true"===b.records[d].div.parent().siblings(".oo-venue-title").attr("data-hidden")&&b.records[d].div.parent().siblings(".oo-venue-title").click(),c||(b.records[d].div.parent().parent().velocity("scroll",{container:b.searchResultsArea,duration:500,easing:"easeInOutCubic"}),c=!0));b.getNewMapCentre(this.getPosition(),250,0)}}},infoWindowCloseClicked:function(){return function(){o.clearInfoWindows(),o.stopMarkerAnimation()}},clearInfoWindows:function(){for(var a=ooSearch,b=a.markers.length,c=0;b>c;c+=1)a.markers[c].infoWindow.close()},stopMarkerAnimation:function(){var a=ooSearch;for(len=a.markers.length,i=0;i<len;i+=1)a.markers[i].marker.setAnimation(null)},addMarkers:function(){},removeMarkers:function(){var a=ooSearch,b=a.markers.length;for(i=0;i<b;i++)a.markers[i].marker.setMap(null);a.markers=[]},animateElements:function(){var a=ooSearch;a.searchContainer.children("h2").velocity("fadeOut",500),a.searchContainer.children("input").velocity("fadeOut",500),a.searchContainer.children("button").velocity("fadeOut",500,function(){a.searchContainer.removeClass("oo-search-window-active"),a.searchContainer.addClass("oo-results-window-active"),$("div.oo-output-container").velocity("fadeIn",500),$("div.oo-output").velocity("fadeIn",500),a.searchResultsArea.css("display","block").html(spinner.el).children(".spinner").css("display","none").velocity("fadeIn",500,function(){a.getResponse()})})},animateElementsBack:function(){var a=ooSearch;$("div.oo-venue").length&&$("div.oo-venue").velocity("fadeOut",500),$("div.oo-output").length&&$("div.oo-output").velocity("fadeOut",500),$("div.oo-result").length&&$("div.oo-result").velocity("fadeOut",500),$("div.oo-no-result").length&&$("div.oo-no-result").velocity("fadeOut",500),$("div.oo-more-results").length&&$("div.oo-more-results").velocity("fadeOut",500),$("div.oo-output-container").velocity("fadeOut",500,function(){a.searchContainer.removeClass("oo-results-window-active"),a.searchContainer.addClass("oo-search-window-active"),a.searchContainer.children("input").val(""),a.searchContainer.children("h2").velocity("fadeIn",500),a.searchContainer.children("input").velocity("fadeIn",500,function(){a.searchContainer.children("input:first").focus(),a.searchContainer.children("button").velocity("fadeIn",500)})})},getNewMapCentre:function(a,b,c){var d=ooSearch,e=d.map.getProjection().fromLatLngToPoint(a instanceof google.maps.LatLng?a:d.map.getCenter()),f=new google.maps.Point(("number"==typeof b?b:0)/Math.pow(2,d.map.getZoom())||0,("number"==typeof c?c:0)/Math.pow(2,d.map.getZoom())||0);d.map.panTo(d.map.getProjection().fromPointToLatLng(new google.maps.Point(e.x-f.x,e.y+f.y)))},centerMap:function(){for(var a=ooSearch,b=new google.maps.LatLngBounds,c=a.records.length,d=0;c>d;d+=1)b.extend(a.records[d].coordinates);a.map.fitBounds(b);var e=a.map.getZoom();a.map.setZoom(e>12?12:e),a.getNewMapCentre(b.getCenter(),250,0)},getResponse:function(a){var b="https://api.openobjects.com/rest/v1/kent/records?key=cd6fc53d-7751-4bd3-804c-90f1dfc6bef5&query=%2Bservice_type:event",c=$("input.oo-query").val(),d=$("input.oo-location").val();""!==c&&null!==c&&" "!==c&&(c=encodeURIComponent(c),b+="+%2B"+c),""!==d&&null!==d&&" "!==d&&(b+="&spatialLocation="+d,b+="&spatialRadius=5"),b+="&count=10",b+="&sortType=field&sortOrder=0&sortField=venue_name",a&&(b+="&startIndex="+a);try{this.yql="http://query.yahooapis.com/v1/public/yql?q="+encodeURIComponent('select * from xml where url="'+b+'"')+"&format=xml&callback=?"}catch(e){alert("error")}ooSearch.site=b,ooSearch.processResponse()},addLinks:function(a){return function(){window.location.href=ooSearch.records[a].url}},processResponse:function(){var a=ooSearch;$.getJSON(a.yql,function(b){var c=$.parseXML(b.results[0]),d=$(c),e=d.find("record"),f=e.length;if(a.searchResultsArea.html(""),a.nextPage=null,!f)return a.searchResultsArea.append('<div class="oo-no-result">No results found. Please <a href="#" class="oo-try-searching-again">try another search</a>.</div>').css("display","none").velocity("fadeIn",500),void $("a.oo-try-searching-again").click(function(){$("button.oo-search-again").click()});a.records=[];var g=[],h=0;if(e.each(function(){if(!($(this).find("location_postcode__latitude__stored").length&&$(this).find("location_postcode__longitude__stored").length&&$(this).find("venue_name").length))return!0;if(a.records.push({}),a.records[h].recordId=$(this).find("id").text(),a.records[h].url="http://search3.openobjects.com/kb5/kent/directory/event.page?id="+a.records[h].recordId,a.records[h].lat=$(this).find("location_postcode__latitude__stored"),a.records[h].lng=$(this).find("location_postcode__longitude__stored"),a.records[h].lat.length&&a.records[h].lng.length){a.records[h].lat=parseFloat(a.records[h].lat.text()),a.records[h].lng=parseFloat(a.records[h].lng.text());var b=(a.records[h].lat+a.records[h].lng).toString(),c=new google.maps.LatLng(a.records[h].lat,a.records[h].lng);a.records[h].coordinates=c,a.records[h].coordinatesUniqueId=b}a.records[h].venue=$(this).find("venue_name").text(),a.records[h].venueId=a.records[h].venue.replace(/ /g,"-").replace(/,/g,"").replace(/\./g,"").replace(/\(/g,"").replace(/\)/g,"").replace(/&/g,"").replace(/\'/g,"").replace(/[1-9]/g,""),a.records[h].title=$(this).find("title").text(),a.records[h].description=$(this).find("description").text()?$(this).find("description").text().replace("<p>","").replace("</p>","").replace("<span>","").replace("</span>","").replace("<div>","").replace("</div>",""):"No description available.",a.records[h].siteName=$(this).find("venue_name").text(),g.push('<div class="oo-result oo-record-'+h+'"><p class="oo-title"><a href="'+a.records[h].url+'">'+a.records[h].title+'</a></p><p class="oo-description">'+a.records[h].description+"</p></div>"),h++}),!a.records.length)return a.searchResultsArea.append('<div class="oo-no-result">No results found. Please <a href="#" class="oo-try-searching-again">try another search</a>.</div>').css("display","none").velocity("fadeIn",500),void $("a.oo-try-searching-again").click(function(){$("button.oo-search-again").click()});a.venues=[];for(var i=a.records.length,h=0;i>h;h+=1){var j;j=$("html").hasClass("lt-ie9")?!0:!1,a.searchResultsArea.find("div."+a.records[h].venueId).length||(a.venues.push(a.records[h].venueId),a.searchResultsArea.append(j?'<div class="oo-venue '+a.records[h].venueId+'"><div class="oo-venue-title" tabindex="0">'+a.records[h].venue+'<div class="icon-arrow-minus-ie8 icon-open"></div></div><div class="oo-results-container"></div></div>':'<div class="oo-venue '+a.records[h].venueId+'"><div class="oo-venue-title" tabindex="0">'+a.records[h].venue+'<div class="icon-arrow-minus icon-open"></div></div><div class="oo-results-container"></div></div>')),a.searchResultsArea.find("div."+a.records[h].venueId).find("div.oo-results-container").append(g[h]),a.records[h].div=a.searchResultsArea.find("div.oo-record-"+h),a.records[h].div.hide()}a.searchResultsArea.find("div.oo-result").velocity("fadeIn",500),d.find("nextPage").length&&(a.nextPage=d.find("nextPage").text(),a.nextPage=a.nextPage.substring(a.nextPage.indexOf("startIndex=")+11,a.nextPage.indexOf("&count=")),a.searchResultsArea.append('<div class="oo-more-results">').find("div.oo-more-results").append('<a href="#" class="oo-more-results-link">Show more results</a>').find("a.oo-more-results-link").click(function(){$("div.oo-result").length&&$("div.oo-result").velocity("fadeOut",500),$("div.oo-venue").length&&$("div.oo-venue").velocity("fadeOut",500),$(this).velocity("fadeOut",500,function(){a.searchResultsArea.html(spinner.el).children(".spinner").css("display","none").velocity("fadeIn",500);var b=a.markers.length;for(h=0;b>h;h+=1)google.maps.event.clearListeners(a.markers[h].marker,"click");a.getResponse(a.nextPage)})})),a.removeMarkers(),a.centerMap();var k=[],l=a.records.length;for(h=0;l>h;h+=1)if(-1===k.indexOf(a.records[h].coordinatesUniqueId)){k.push(a.records[h].coordinatesUniqueId);var m=new google.maps.Marker({map:a.map,animation:google.maps.Animation.DROP,position:a.records[h].coordinates});a.markers.push({marker:m,uniqueId:a.records[h].coordinatesUniqueId,siteName:a.records[h].siteName}),a.records[h].marker=a.markers[a.markers.length-1].marker,a.markers[a.markers.length-1].infoWindow=new google.maps.InfoWindow({content:'<p style="text-align:center; margin: 0; padding: 0;  white-space: nowrap;">'+a.records[h].venue+"</p>",maxWidth:300,disableAutoPan:!0})}else for(var n=a.markers.length,o=0;n>o;o+=1)if(a.markers[o].uniqueId===a.records[h].coordinatesUniqueId){a.records[h].marker=a.markers[o].marker;break}for(i=a.markers.length,h=0;i>h;h+=1)google.maps.event.addListener(a.markers[h].marker,"click",a.bindEvents(h)),google.maps.event.addListener(a.markers[h].infoWindow,"closeclick",a.infoWindowCloseClicked(h));$(".oo-venue-title").click(function(){var a=$(this);a.siblings(".oo-results-container").eq(0).hasClass("velocity-animating")||("true"===a.attr("data-hidden")?(a.children(".icon-arrow-minus").addClass("icon-open"),a.siblings(".oo-results-container").velocity("slideDown",{duration:500,easing:"easeInOutCubic",complete:function(){a.attr("data-hidden","false")}})):(a.children(".icon-arrow-minus").removeClass("icon-open"),a.siblings(".oo-results-container").velocity("slideUp",{duration:500,easing:"easeInOutCubic",complete:function(){a.attr("data-hidden","true")}})))}),$("div.oo-venue-title").on("keyup",function(a){var b=a.keyCode||a.which;13==b&&$(this).click()})})}},o=ooSearch;o.init(),o.searchButton.click(function(){o.animateElements($(window).width()>=640?!1:!0)}),o.searchAgainButton.click(function(){var a=o.markers.length;for(i=0;i<a;i+=1)google.maps.event.clearListeners(o.markers[i].marker,"click");o.animateElementsBack($(window).width()>=640?!1:!0),o.removeMarkers(),o.map.panTo(new google.maps.LatLng(51.2088793,.4261792)),o.map.setZoom(10)}),o.searchInputs.on("keyup",function(a){var b=a.keyCode||a.which;13==b&&o.searchButton.click()}),$(document).ready(function(){var a={lines:11,length:10,width:3,radius:8,corners:1,rotate:0,direction:1,color:"#000",speed:1,trail:60,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"50%",left:"50%"};spinner=new Spinner(a).spin()});var ooSearch={markers:[],map:{},records:[],init:function(){Array.prototype.indexOf||(Array.prototype.indexOf=function(a){var b=this.length>>>0,c=Number(arguments[1])||0;for(c=0>c?Math.ceil(c):Math.floor(c),0>c&&(c+=b);b>c;c++)if(c in this&&this[c]===a)return c;return-1}),this.searchContainer=$("div.oo-container"),this.searchButton=$("button.oo-search"),this.searchResultsArea=$("div.oo-output"),this.searchAgainButton=$("button.oo-search-again"),this.searchInputs=$("input.oo-input"),ooSearch.loadMap()},loadMap:function(){var a=[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]}];ooSearch.map=new google.maps.Map(document.getElementById("oo-map"),{zoom:10,center:new google.maps.LatLng(51.2088793,.4261792),mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:!0,styles:a,scrollwheel:!1})},bindEvents:function(a){var b=ooSearch;return function(){if(b.clearInfoWindows(),this.getAnimation())this.setAnimation(null),b.markers[a].infoWindow.close();else{b.stopMarkerAnimation(),this.setAnimation(google.maps.Animation.BOUNCE),b.markers[a].infoWindow.open(b.map,b.markers[a].marker);for(var c=!1,d=0;d<b.records.length;d+=1)b.records[d].coordinatesUniqueId===b.markers[a].uniqueId&&($(".oo-venue-title").not(b.records[d].div.parent().siblings(".oo-venue-title")).each(function(){"true"!==$(this).attr("data-hidden")&&$(this).click()}),"true"===b.records[d].div.parent().siblings(".oo-venue-title").attr("data-hidden")&&b.records[d].div.parent().siblings(".oo-venue-title").click(),c||(b.records[d].div.parent().parent().velocity("scroll",{container:b.searchResultsArea,duration:500,easing:"easeInOutCubic"}),c=!0));b.getNewMapCentre(this.getPosition(),250,0)}}},infoWindowCloseClicked:function(){return function(){o.clearInfoWindows(),o.stopMarkerAnimation()}},clearInfoWindows:function(){for(var a=ooSearch,b=a.markers.length,c=0;b>c;c+=1)a.markers[c].infoWindow.close()},stopMarkerAnimation:function(){var a=ooSearch;for(len=a.markers.length,i=0;i<len;i+=1)a.markers[i].marker.setAnimation(null)},addMarkers:function(){},removeMarkers:function(){var a=ooSearch,b=a.markers.length;for(i=0;i<b;i++)a.markers[i].marker.setMap(null);a.markers=[]},animateElements:function(){var a=ooSearch;a.searchContainer.children("h2").velocity("fadeOut",500),a.searchContainer.children("input").velocity("fadeOut",500),a.searchContainer.children("button").velocity("fadeOut",500,function(){a.searchContainer.removeClass("oo-search-window-active"),a.searchContainer.addClass("oo-results-window-active"),$("div.oo-output-container").velocity("fadeIn",500),$("div.oo-output").velocity("fadeIn",500),a.searchResultsArea.css("display","block").html(spinner.el).children(".spinner").css("display","none").velocity("fadeIn",500,function(){a.getResponse()})})},animateElementsBack:function(){var a=ooSearch;$("div.oo-venue").length&&$("div.oo-venue").velocity("fadeOut",500),$("div.oo-output").length&&$("div.oo-output").velocity("fadeOut",500),$("div.oo-result").length&&$("div.oo-result").velocity("fadeOut",500),$("div.oo-no-result").length&&$("div.oo-no-result").velocity("fadeOut",500),$("div.oo-more-results").length&&$("div.oo-more-results").velocity("fadeOut",500),$("div.oo-output-container").velocity("fadeOut",500,function(){a.searchContainer.removeClass("oo-results-window-active"),a.searchContainer.addClass("oo-search-window-active"),a.searchContainer.children("input").val(""),a.searchContainer.children("h2").velocity("fadeIn",500),a.searchContainer.children("input").velocity("fadeIn",500,function(){a.searchContainer.children("input:first").focus(),a.searchContainer.children("button").velocity("fadeIn",500)})})},getNewMapCentre:function(a,b,c){var d=ooSearch,e=d.map.getProjection().fromLatLngToPoint(a instanceof google.maps.LatLng?a:d.map.getCenter()),f=new google.maps.Point(("number"==typeof b?b:0)/Math.pow(2,d.map.getZoom())||0,("number"==typeof c?c:0)/Math.pow(2,d.map.getZoom())||0);d.map.panTo(d.map.getProjection().fromPointToLatLng(new google.maps.Point(e.x-f.x,e.y+f.y)))},centerMap:function(){for(var a=ooSearch,b=new google.maps.LatLngBounds,c=a.records.length,d=0;c>d;d+=1)b.extend(a.records[d].coordinates);a.map.fitBounds(b);var e=a.map.getZoom();a.map.setZoom(e>12?12:e),a.getNewMapCentre(b.getCenter(),250,0)},getResponse:function(a){var b="https://api.openobjects.com/rest/v1/kent/records?key=cd6fc53d-7751-4bd3-804c-90f1dfc6bef5&query=%2Bservice_type:event",c=$("input.oo-query").val(),d=$("input.oo-location").val();""!==c&&null!==c&&" "!==c&&(c=encodeURIComponent(c),b+="+%2B"+c),""!==d&&null!==d&&" "!==d&&(b+="&spatialLocation="+d,b+="&spatialRadius=5"),b+="&count=10",b+="&sortType=field&sortOrder=0&sortField=venue_name",a&&(b+="&startIndex="+a);try{this.yql="http://query.yahooapis.com/v1/public/yql?q="+encodeURIComponent('select * from xml where url="'+b+'"')+"&format=xml&callback=?"}catch(e){alert("error")}ooSearch.site=b,ooSearch.processResponse()},addLinks:function(a){return function(){window.location.href=ooSearch.records[a].url}},processResponse:function(){var a=ooSearch;$.getJSON(a.yql,function(b){var c=$.parseXML(b.results[0]),d=$(c),e=d.find("record"),f=e.length;if(a.searchResultsArea.html(""),a.nextPage=null,!f)return a.searchResultsArea.append('<div class="oo-no-result">No results found. Please <a href="#" class="oo-try-searching-again">try another search</a>.</div>').css("display","none").velocity("fadeIn",500),void $("a.oo-try-searching-again").click(function(){$("button.oo-search-again").click()});a.records=[];var g=[],h=0;if(e.each(function(){if(!($(this).find("location_postcode__latitude__stored").length&&$(this).find("location_postcode__longitude__stored").length&&$(this).find("venue_name").length))return!0;if(a.records.push({}),a.records[h].recordId=$(this).find("id").text(),a.records[h].url="http://search3.openobjects.com/kb5/kent/directory/event.page?id="+a.records[h].recordId,a.records[h].lat=$(this).find("location_postcode__latitude__stored"),a.records[h].lng=$(this).find("location_postcode__longitude__stored"),a.records[h].lat.length&&a.records[h].lng.length){a.records[h].lat=parseFloat(a.records[h].lat.text()),a.records[h].lng=parseFloat(a.records[h].lng.text());var b=(a.records[h].lat+a.records[h].lng).toString(),c=new google.maps.LatLng(a.records[h].lat,a.records[h].lng);a.records[h].coordinates=c,a.records[h].coordinatesUniqueId=b}a.records[h].venue=$(this).find("venue_name").text(),a.records[h].venueId=a.records[h].venue.replace(/ /g,"-").replace(/,/g,"").replace(/\./g,"").replace(/\(/g,"").replace(/\)/g,"").replace(/&/g,"").replace(/\'/g,"").replace(/[1-9]/g,""),a.records[h].title=$(this).find("title").text(),a.records[h].description=$(this).find("description").text()?$(this).find("description").text().replace("<p>","").replace("</p>","").replace("<span>","").replace("</span>","").replace("<div>","").replace("</div>",""):"No description available.",a.records[h].siteName=$(this).find("venue_name").text(),g.push('<div class="oo-result oo-record-'+h+'"><p class="oo-title"><a href="'+a.records[h].url+'">'+a.records[h].title+'</a></p><p class="oo-description">'+a.records[h].description+"</p></div>"),h++}),!a.records.length)return a.searchResultsArea.append('<div class="oo-no-result">No results found. Please <a href="#" class="oo-try-searching-again">try another search</a>.</div>').css("display","none").velocity("fadeIn",500),void $("a.oo-try-searching-again").click(function(){$("button.oo-search-again").click()});a.venues=[];for(var i=a.records.length,h=0;i>h;h+=1){var j;j=$("html").hasClass("lt-ie9")?!0:!1,a.searchResultsArea.find("div."+a.records[h].venueId).length||(a.venues.push(a.records[h].venueId),a.searchResultsArea.append(j?'<div class="oo-venue '+a.records[h].venueId+'"><div class="oo-venue-title" tabindex="0">'+a.records[h].venue+'<div class="icon-arrow-minus-ie8 icon-open"></div></div><div class="oo-results-container"></div></div>':'<div class="oo-venue '+a.records[h].venueId+'"><div class="oo-venue-title" tabindex="0">'+a.records[h].venue+'<div class="icon-arrow-minus icon-open"></div></div><div class="oo-results-container"></div></div>')),a.searchResultsArea.find("div."+a.records[h].venueId).find("div.oo-results-container").append(g[h]),a.records[h].div=a.searchResultsArea.find("div.oo-record-"+h),a.records[h].div.hide()}a.searchResultsArea.find("div.oo-result").velocity("fadeIn",500),d.find("nextPage").length&&(a.nextPage=d.find("nextPage").text(),a.nextPage=a.nextPage.substring(a.nextPage.indexOf("startIndex=")+11,a.nextPage.indexOf("&count=")),a.searchResultsArea.append('<div class="oo-more-results">').find("div.oo-more-results").append('<a href="#" class="oo-more-results-link">Show more results</a>').find("a.oo-more-results-link").click(function(){$("div.oo-result").length&&$("div.oo-result").velocity("fadeOut",500),$("div.oo-venue").length&&$("div.oo-venue").velocity("fadeOut",500),$(this).velocity("fadeOut",500,function(){a.searchResultsArea.html(spinner.el).children(".spinner").css("display","none").velocity("fadeIn",500);var b=a.markers.length;for(h=0;b>h;h+=1)google.maps.event.clearListeners(a.markers[h].marker,"click");a.getResponse(a.nextPage)})})),a.removeMarkers(),a.centerMap();var k=[],l=a.records.length;for(h=0;l>h;h+=1)if(-1===k.indexOf(a.records[h].coordinatesUniqueId)){k.push(a.records[h].coordinatesUniqueId);var m=new google.maps.Marker({map:a.map,animation:google.maps.Animation.DROP,position:a.records[h].coordinates});a.markers.push({marker:m,uniqueId:a.records[h].coordinatesUniqueId,siteName:a.records[h].siteName}),a.records[h].marker=a.markers[a.markers.length-1].marker,a.markers[a.markers.length-1].infoWindow=new google.maps.InfoWindow({content:'<p style="text-align:center; margin: 0; padding: 0;  white-space: nowrap;">'+a.records[h].venue+"</p>",maxWidth:300,disableAutoPan:!0})}else for(var n=a.markers.length,o=0;n>o;o+=1)if(a.markers[o].uniqueId===a.records[h].coordinatesUniqueId){a.records[h].marker=a.markers[o].marker;break}for(i=a.markers.length,h=0;i>h;h+=1)google.maps.event.addListener(a.markers[h].marker,"click",a.bindEvents(h)),google.maps.event.addListener(a.markers[h].infoWindow,"closeclick",a.infoWindowCloseClicked(h));$(".oo-venue-title").click(function(){var a=$(this);a.siblings(".oo-results-container").eq(0).hasClass("velocity-animating")||("true"===a.attr("data-hidden")?(a.children(".icon-arrow-minus").addClass("icon-open"),a.siblings(".oo-results-container").velocity("slideDown",{duration:500,easing:"easeInOutCubic",complete:function(){a.attr("data-hidden","false")}})):(a.children(".icon-arrow-minus").removeClass("icon-open"),a.siblings(".oo-results-container").velocity("slideUp",{duration:500,easing:"easeInOutCubic",complete:function(){a.attr("data-hidden","true")}})))}),$("div.oo-venue-title").on("keyup",function(a){var b=a.keyCode||a.which;13==b&&$(this).click()})})}},o=ooSearch;o.init(),o.searchButton.click(function(){o.animateElements($(window).width()>=640?!1:!0)}),o.searchAgainButton.click(function(){var a=o.markers.length;for(i=0;i<a;i+=1)google.maps.event.clearListeners(o.markers[i].marker,"click");o.animateElementsBack($(window).width()>=640?!1:!0),o.removeMarkers(),o.map.panTo(new google.maps.LatLng(51.2088793,.4261792)),o.map.setZoom(10)}),o.searchInputs.on("keyup",function(a){var b=a.keyCode||a.which;13==b&&o.searchButton.click()}),$(document).ready(function(){var a={lines:11,length:10,width:3,radius:8,corners:1,rotate:0,direction:1,color:"#000",speed:1,trail:60,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"50%",left:"50%"};spinner=new Spinner(a).spin()});var ooSearch={markers:[],map:{},records:[],init:function(){Array.prototype.indexOf||(Array.prototype.indexOf=function(a){var b=this.length>>>0,c=Number(arguments[1])||0;for(c=0>c?Math.ceil(c):Math.floor(c),0>c&&(c+=b);b>c;c++)if(c in this&&this[c]===a)return c;return-1}),this.searchContainer=$("div.oo-container"),this.searchButton=$("button.oo-search"),this.searchResultsArea=$("div.oo-output"),this.searchAgainButton=$("button.oo-search-again"),this.searchInputs=$("input.oo-input"),ooSearch.loadMap()},loadMap:function(){var a=[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]}];ooSearch.map=new google.maps.Map(document.getElementById("oo-map"),{zoom:10,center:new google.maps.LatLng(51.2088793,.4261792),mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:!0,styles:a,scrollwheel:!1})},bindEvents:function(a){var b=ooSearch;return function(){if(b.clearInfoWindows(),this.getAnimation())this.setAnimation(null),b.markers[a].infoWindow.close();else{b.stopMarkerAnimation(),this.setAnimation(google.maps.Animation.BOUNCE),b.markers[a].infoWindow.open(b.map,b.markers[a].marker);for(var c=!1,d=0;d<b.records.length;d+=1)b.records[d].coordinatesUniqueId===b.markers[a].uniqueId&&($(".oo-venue-title").not(b.records[d].div.parent().siblings(".oo-venue-title")).each(function(){"true"!==$(this).attr("data-hidden")&&$(this).click()}),"true"===b.records[d].div.parent().siblings(".oo-venue-title").attr("data-hidden")&&b.records[d].div.parent().siblings(".oo-venue-title").click(),c||(b.records[d].div.parent().parent().velocity("scroll",{container:b.searchResultsArea,duration:500,easing:"easeInOutCubic"}),c=!0));b.getNewMapCentre(this.getPosition(),250,0)}}},infoWindowCloseClicked:function(){return function(){o.clearInfoWindows(),o.stopMarkerAnimation()}},clearInfoWindows:function(){for(var a=ooSearch,b=a.markers.length,c=0;b>c;c+=1)a.markers[c].infoWindow.close()},stopMarkerAnimation:function(){var a=ooSearch;for(len=a.markers.length,i=0;i<len;i+=1)a.markers[i].marker.setAnimation(null)},addMarkers:function(){},removeMarkers:function(){var a=ooSearch,b=a.markers.length;for(i=0;i<b;i++)a.markers[i].marker.setMap(null);a.markers=[]},animateElements:function(){var a=ooSearch;a.searchContainer.children("h2").velocity("fadeOut",500),a.searchContainer.children("input").velocity("fadeOut",500),a.searchContainer.children("button").velocity("fadeOut",500,function(){a.searchContainer.removeClass("oo-search-window-active"),a.searchContainer.addClass("oo-results-window-active"),$("div.oo-output-container").velocity("fadeIn",500),$("div.oo-output").velocity("fadeIn",500),a.searchResultsArea.css("display","block").html(spinner.el).children(".spinner").css("display","none").velocity("fadeIn",500,function(){a.getResponse()})})},animateElementsBack:function(){var a=ooSearch;$("div.oo-venue").length&&$("div.oo-venue").velocity("fadeOut",500),$("div.oo-output").length&&$("div.oo-output").velocity("fadeOut",500),$("div.oo-result").length&&$("div.oo-result").velocity("fadeOut",500),$("div.oo-no-result").length&&$("div.oo-no-result").velocity("fadeOut",500),$("div.oo-more-results").length&&$("div.oo-more-results").velocity("fadeOut",500),$("div.oo-output-container").velocity("fadeOut",500,function(){a.searchContainer.removeClass("oo-results-window-active"),a.searchContainer.addClass("oo-search-window-active"),a.searchContainer.children("input").val(""),a.searchContainer.children("h2").velocity("fadeIn",500),a.searchContainer.children("input").velocity("fadeIn",500,function(){a.searchContainer.children("input:first").focus(),a.searchContainer.children("button").velocity("fadeIn",500)})})},getNewMapCentre:function(a,b,c){var d=ooSearch,e=d.map.getProjection().fromLatLngToPoint(a instanceof google.maps.LatLng?a:d.map.getCenter()),f=new google.maps.Point(("number"==typeof b?b:0)/Math.pow(2,d.map.getZoom())||0,("number"==typeof c?c:0)/Math.pow(2,d.map.getZoom())||0);d.map.panTo(d.map.getProjection().fromPointToLatLng(new google.maps.Point(e.x-f.x,e.y+f.y)))},centerMap:function(){for(var a=ooSearch,b=new google.maps.LatLngBounds,c=a.records.length,d=0;c>d;d+=1)b.extend(a.records[d].coordinates);a.map.fitBounds(b);var e=a.map.getZoom();a.map.setZoom(e>12?12:e),a.getNewMapCentre(b.getCenter(),250,0)},getResponse:function(a){var b="https://api.openobjects.com/rest/v1/kent/records?key=cd6fc53d-7751-4bd3-804c-90f1dfc6bef5&query=%2Bservice_type:event",c=$("input.oo-query").val(),d=$("input.oo-location").val();""!==c&&null!==c&&" "!==c&&(c=encodeURIComponent(c),b+="+%2B"+c),""!==d&&null!==d&&" "!==d&&(b+="&spatialLocation="+d,b+="&spatialRadius=5"),b+="&count=10",b+="&sortType=field&sortOrder=0&sortField=venue_name",a&&(b+="&startIndex="+a);try{this.yql="http://query.yahooapis.com/v1/public/yql?q="+encodeURIComponent('select * from xml where url="'+b+'"')+"&format=xml&callback=?"}catch(e){alert("error")}ooSearch.site=b,ooSearch.processResponse()},addLinks:function(a){return function(){window.location.href=ooSearch.records[a].url}},processResponse:function(){var a=ooSearch;$.getJSON(a.yql,function(b){var c=$.parseXML(b.results[0]),d=$(c),e=d.find("record"),f=e.length;if(a.searchResultsArea.html(""),a.nextPage=null,!f)return a.searchResultsArea.append('<div class="oo-no-result">No results found. Please <a href="#" class="oo-try-searching-again">try another search</a>.</div>').css("display","none").velocity("fadeIn",500),void $("a.oo-try-searching-again").click(function(){$("button.oo-search-again").click()});a.records=[];var g=[],h=0;if(e.each(function(){if(!($(this).find("location_postcode__latitude__stored").length&&$(this).find("location_postcode__longitude__stored").length&&$(this).find("venue_name").length))return!0;if(a.records.push({}),a.records[h].recordId=$(this).find("id").text(),a.records[h].url="http://search3.openobjects.com/kb5/kent/directory/event.page?id="+a.records[h].recordId,a.records[h].lat=$(this).find("location_postcode__latitude__stored"),a.records[h].lng=$(this).find("location_postcode__longitude__stored"),a.records[h].lat.length&&a.records[h].lng.length){a.records[h].lat=parseFloat(a.records[h].lat.text()),a.records[h].lng=parseFloat(a.records[h].lng.text());var b=(a.records[h].lat+a.records[h].lng).toString(),c=new google.maps.LatLng(a.records[h].lat,a.records[h].lng);a.records[h].coordinates=c,a.records[h].coordinatesUniqueId=b}a.records[h].venue=$(this).find("venue_name").text(),a.records[h].venueId=a.records[h].venue.replace(/ /g,"-").replace(/,/g,"").replace(/\./g,"").replace(/\(/g,"").replace(/\)/g,"").replace(/&/g,"").replace(/\'/g,"").replace(/[1-9]/g,""),a.records[h].title=$(this).find("title").text(),a.records[h].description=$(this).find("description").text()?$(this).find("description").text().replace("<p>","").replace("</p>","").replace("<span>","").replace("</span>","").replace("<div>","").replace("</div>",""):"No description available.",a.records[h].siteName=$(this).find("venue_name").text(),g.push('<div class="oo-result oo-record-'+h+'"><p class="oo-title"><a href="'+a.records[h].url+'">'+a.records[h].title+'</a></p><p class="oo-description">'+a.records[h].description+"</p></div>"),h++}),!a.records.length)return a.searchResultsArea.append('<div class="oo-no-result">No results found. Please <a href="#" class="oo-try-searching-again">try another search</a>.</div>').css("display","none").velocity("fadeIn",500),void $("a.oo-try-searching-again").click(function(){$("button.oo-search-again").click()});a.venues=[];for(var i=a.records.length,h=0;i>h;h+=1){var j;j=$("html").hasClass("lt-ie9")?!0:!1,a.searchResultsArea.find("div."+a.records[h].venueId).length||(a.venues.push(a.records[h].venueId),a.searchResultsArea.append(j?'<div class="oo-venue '+a.records[h].venueId+'"><div class="oo-venue-title" tabindex="0">'+a.records[h].venue+'<div class="icon-arrow-minus-ie8 icon-open"></div></div><div class="oo-results-container"></div></div>':'<div class="oo-venue '+a.records[h].venueId+'"><div class="oo-venue-title" tabindex="0">'+a.records[h].venue+'<div class="icon-arrow-minus icon-open"></div></div><div class="oo-results-container"></div></div>')),a.searchResultsArea.find("div."+a.records[h].venueId).find("div.oo-results-container").append(g[h]),a.records[h].div=a.searchResultsArea.find("div.oo-record-"+h),a.records[h].div.hide()}a.searchResultsArea.find("div.oo-result").velocity("fadeIn",500),d.find("nextPage").length&&(a.nextPage=d.find("nextPage").text(),a.nextPage=a.nextPage.substring(a.nextPage.indexOf("startIndex=")+11,a.nextPage.indexOf("&count=")),a.searchResultsArea.append('<div class="oo-more-results">').find("div.oo-more-results").append('<a href="#" class="oo-more-results-link">Show more results</a>').find("a.oo-more-results-link").click(function(){$("div.oo-result").length&&$("div.oo-result").velocity("fadeOut",500),$("div.oo-venue").length&&$("div.oo-venue").velocity("fadeOut",500),$(this).velocity("fadeOut",500,function(){a.searchResultsArea.html(spinner.el).children(".spinner").css("display","none").velocity("fadeIn",500);
var b=a.markers.length;for(h=0;b>h;h+=1)google.maps.event.clearListeners(a.markers[h].marker,"click");a.getResponse(a.nextPage)})})),a.removeMarkers(),a.centerMap();var k=[],l=a.records.length;for(h=0;l>h;h+=1)if(-1===k.indexOf(a.records[h].coordinatesUniqueId)){k.push(a.records[h].coordinatesUniqueId);var m=new google.maps.Marker({map:a.map,animation:google.maps.Animation.DROP,position:a.records[h].coordinates});a.markers.push({marker:m,uniqueId:a.records[h].coordinatesUniqueId,siteName:a.records[h].siteName}),a.records[h].marker=a.markers[a.markers.length-1].marker,a.markers[a.markers.length-1].infoWindow=new google.maps.InfoWindow({content:'<p style="text-align:center; margin: 0; padding: 0;  white-space: nowrap;">'+a.records[h].venue+"</p>",maxWidth:300,disableAutoPan:!0})}else for(var n=a.markers.length,o=0;n>o;o+=1)if(a.markers[o].uniqueId===a.records[h].coordinatesUniqueId){a.records[h].marker=a.markers[o].marker;break}for(i=a.markers.length,h=0;i>h;h+=1)google.maps.event.addListener(a.markers[h].marker,"click",a.bindEvents(h)),google.maps.event.addListener(a.markers[h].infoWindow,"closeclick",a.infoWindowCloseClicked(h));$(".oo-venue-title").click(function(){var a=$(this);a.siblings(".oo-results-container").eq(0).hasClass("velocity-animating")||("true"===a.attr("data-hidden")?(a.children(".icon-arrow-minus").addClass("icon-open"),a.siblings(".oo-results-container").velocity("slideDown",{duration:500,easing:"easeInOutCubic",complete:function(){a.attr("data-hidden","false")}})):(a.children(".icon-arrow-minus").removeClass("icon-open"),a.siblings(".oo-results-container").velocity("slideUp",{duration:500,easing:"easeInOutCubic",complete:function(){a.attr("data-hidden","true")}})))}),$("div.oo-venue-title").on("keyup",function(a){var b=a.keyCode||a.which;13==b&&$(this).click()})})}},o=ooSearch;o.init(),o.searchButton.click(function(){o.animateElements($(window).width()>=640?!1:!0)}),o.searchAgainButton.click(function(){var a=o.markers.length;for(i=0;i<a;i+=1)google.maps.event.clearListeners(o.markers[i].marker,"click");o.animateElementsBack($(window).width()>=640?!1:!0),o.removeMarkers(),o.map.panTo(new google.maps.LatLng(51.2088793,.4261792)),o.map.setZoom(10)}),o.searchInputs.on("keyup",function(a){var b=a.keyCode||a.which;13==b&&o.searchButton.click()}),$(document).ready(function(){var a={lines:11,length:10,width:3,radius:8,corners:1,rotate:0,direction:1,color:"#000",speed:1,trail:60,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"50%",left:"50%"};spinner=new Spinner(a).spin()});var ooSearch={markers:[],map:{},records:[],init:function(){Array.prototype.indexOf||(Array.prototype.indexOf=function(a){var b=this.length>>>0,c=Number(arguments[1])||0;for(c=0>c?Math.ceil(c):Math.floor(c),0>c&&(c+=b);b>c;c++)if(c in this&&this[c]===a)return c;return-1}),this.searchContainer=$("div.oo-container"),this.searchButton=$("button.oo-search"),this.searchResultsArea=$("div.oo-output"),this.searchAgainButton=$("button.oo-search-again"),this.searchInputs=$("input.oo-input"),ooSearch.loadMap()},loadMap:function(){var a=[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]}];ooSearch.map=new google.maps.Map(document.getElementById("oo-map"),{zoom:10,center:new google.maps.LatLng(51.2088793,.4261792),mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:!0,styles:a,scrollwheel:!1})},bindEvents:function(a){var b=ooSearch;return function(){if(b.clearInfoWindows(),this.getAnimation())this.setAnimation(null),b.markers[a].infoWindow.close();else{b.stopMarkerAnimation(),this.setAnimation(google.maps.Animation.BOUNCE),b.markers[a].infoWindow.open(b.map,b.markers[a].marker);for(var c=!1,d=0;d<b.records.length;d+=1)b.records[d].coordinatesUniqueId===b.markers[a].uniqueId&&($(".oo-venue-title").not(b.records[d].div.parent().siblings(".oo-venue-title")).each(function(){"true"!==$(this).attr("data-hidden")&&$(this).click()}),"true"===b.records[d].div.parent().siblings(".oo-venue-title").attr("data-hidden")&&b.records[d].div.parent().siblings(".oo-venue-title").click(),c||(b.records[d].div.parent().parent().velocity("scroll",{container:b.searchResultsArea,duration:500,easing:"easeInOutCubic"}),c=!0));b.getNewMapCentre(this.getPosition(),250,0)}}},infoWindowCloseClicked:function(){return function(){o.clearInfoWindows(),o.stopMarkerAnimation()}},clearInfoWindows:function(){for(var a=ooSearch,b=a.markers.length,c=0;b>c;c+=1)a.markers[c].infoWindow.close()},stopMarkerAnimation:function(){var a=ooSearch;for(len=a.markers.length,i=0;i<len;i+=1)a.markers[i].marker.setAnimation(null)},addMarkers:function(){},removeMarkers:function(){var a=ooSearch,b=a.markers.length;for(i=0;i<b;i++)a.markers[i].marker.setMap(null);a.markers=[]},animateElements:function(){var a=ooSearch;a.searchContainer.children("h2").velocity("fadeOut",500),a.searchContainer.children("input").velocity("fadeOut",500),a.searchContainer.children("button").velocity("fadeOut",500,function(){a.searchContainer.removeClass("oo-search-window-active"),a.searchContainer.addClass("oo-results-window-active"),$("div.oo-output-container").velocity("fadeIn",500),$("div.oo-output").velocity("fadeIn",500),a.searchResultsArea.css("display","block").html(spinner.el).children(".spinner").css("display","none").velocity("fadeIn",500,function(){a.getResponse()})})},animateElementsBack:function(){var a=ooSearch;$("div.oo-venue").length&&$("div.oo-venue").velocity("fadeOut",500),$("div.oo-output").length&&$("div.oo-output").velocity("fadeOut",500),$("div.oo-result").length&&$("div.oo-result").velocity("fadeOut",500),$("div.oo-no-result").length&&$("div.oo-no-result").velocity("fadeOut",500),$("div.oo-more-results").length&&$("div.oo-more-results").velocity("fadeOut",500),$("div.oo-output-container").velocity("fadeOut",500,function(){a.searchContainer.removeClass("oo-results-window-active"),a.searchContainer.addClass("oo-search-window-active"),a.searchContainer.children("input").val(""),a.searchContainer.children("h2").velocity("fadeIn",500),a.searchContainer.children("input").velocity("fadeIn",500,function(){a.searchContainer.children("input:first").focus(),a.searchContainer.children("button").velocity("fadeIn",500)})})},getNewMapCentre:function(a,b,c){var d=ooSearch,e=d.map.getProjection().fromLatLngToPoint(a instanceof google.maps.LatLng?a:d.map.getCenter()),f=new google.maps.Point(("number"==typeof b?b:0)/Math.pow(2,d.map.getZoom())||0,("number"==typeof c?c:0)/Math.pow(2,d.map.getZoom())||0);d.map.panTo(d.map.getProjection().fromPointToLatLng(new google.maps.Point(e.x-f.x,e.y+f.y)))},centerMap:function(){for(var a=ooSearch,b=new google.maps.LatLngBounds,c=a.records.length,d=0;c>d;d+=1)b.extend(a.records[d].coordinates);a.map.fitBounds(b);var e=a.map.getZoom();a.map.setZoom(e>12?12:e),a.getNewMapCentre(b.getCenter(),250,0)},getResponse:function(a){var b="https://api.openobjects.com/rest/v1/kent/records?key=cd6fc53d-7751-4bd3-804c-90f1dfc6bef5&query=%2Bservice_type:event",c=$("input.oo-query").val(),d=$("input.oo-location").val();""!==c&&null!==c&&" "!==c&&(c=encodeURIComponent(c),b+="+%2B"+c),""!==d&&null!==d&&" "!==d&&(b+="&spatialLocation="+d,b+="&spatialRadius=5"),b+="&count=10",b+="&sortType=field&sortOrder=0&sortField=venue_name",a&&(b+="&startIndex="+a);try{this.yql="http://query.yahooapis.com/v1/public/yql?q="+encodeURIComponent('select * from xml where url="'+b+'"')+"&format=xml&callback=?"}catch(e){alert("error")}ooSearch.site=b,ooSearch.processResponse()},addLinks:function(a){return function(){window.location.href=ooSearch.records[a].url}},processResponse:function(){var a=ooSearch;$.getJSON(a.yql,function(b){var c=$.parseXML(b.results[0]),d=$(c),e=d.find("record"),f=e.length;if(a.searchResultsArea.html(""),a.nextPage=null,!f)return a.searchResultsArea.append('<div class="oo-no-result">No results found. Please <a href="#" class="oo-try-searching-again">try another search</a>.</div>').css("display","none").velocity("fadeIn",500),void $("a.oo-try-searching-again").click(function(){$("button.oo-search-again").click()});a.records=[];var g=[],h=0;if(e.each(function(){if(!($(this).find("location_postcode__latitude__stored").length&&$(this).find("location_postcode__longitude__stored").length&&$(this).find("venue_name").length))return!0;if(a.records.push({}),a.records[h].recordId=$(this).find("id").text(),a.records[h].url="http://search3.openobjects.com/kb5/kent/directory/event.page?id="+a.records[h].recordId,a.records[h].lat=$(this).find("location_postcode__latitude__stored"),a.records[h].lng=$(this).find("location_postcode__longitude__stored"),a.records[h].lat.length&&a.records[h].lng.length){a.records[h].lat=parseFloat(a.records[h].lat.text()),a.records[h].lng=parseFloat(a.records[h].lng.text());var b=(a.records[h].lat+a.records[h].lng).toString(),c=new google.maps.LatLng(a.records[h].lat,a.records[h].lng);a.records[h].coordinates=c,a.records[h].coordinatesUniqueId=b}a.records[h].venue=$(this).find("venue_name").text(),a.records[h].venueId=a.records[h].venue.replace(/ /g,"-").replace(/,/g,"").replace(/\./g,"").replace(/\(/g,"").replace(/\)/g,"").replace(/&/g,"").replace(/\'/g,"").replace(/[1-9]/g,""),a.records[h].title=$(this).find("title").text(),a.records[h].description=$(this).find("description").text()?$(this).find("description").text().replace("<p>","").replace("</p>","").replace("<span>","").replace("</span>","").replace("<div>","").replace("</div>",""):"No description available.",a.records[h].siteName=$(this).find("venue_name").text(),g.push('<div class="oo-result oo-record-'+h+'"><p class="oo-title"><a href="'+a.records[h].url+'">'+a.records[h].title+'</a></p><p class="oo-description">'+a.records[h].description+"</p></div>"),h++}),!a.records.length)return a.searchResultsArea.append('<div class="oo-no-result">No results found. Please <a href="#" class="oo-try-searching-again">try another search</a>.</div>').css("display","none").velocity("fadeIn",500),void $("a.oo-try-searching-again").click(function(){$("button.oo-search-again").click()});a.venues=[];for(var i=a.records.length,h=0;i>h;h+=1){var j;j=$("html").hasClass("lt-ie9")?!0:!1,a.searchResultsArea.find("div."+a.records[h].venueId).length||(a.venues.push(a.records[h].venueId),a.searchResultsArea.append(j?'<div class="oo-venue '+a.records[h].venueId+'"><div class="oo-venue-title" tabindex="0">'+a.records[h].venue+'<div class="icon-arrow-minus-ie8 icon-open"></div></div><div class="oo-results-container"></div></div>':'<div class="oo-venue '+a.records[h].venueId+'"><div class="oo-venue-title" tabindex="0">'+a.records[h].venue+'<div class="icon-arrow-minus icon-open"></div></div><div class="oo-results-container"></div></div>')),a.searchResultsArea.find("div."+a.records[h].venueId).find("div.oo-results-container").append(g[h]),a.records[h].div=a.searchResultsArea.find("div.oo-record-"+h),a.records[h].div.hide()}a.searchResultsArea.find("div.oo-result").velocity("fadeIn",500),d.find("nextPage").length&&(a.nextPage=d.find("nextPage").text(),a.nextPage=a.nextPage.substring(a.nextPage.indexOf("startIndex=")+11,a.nextPage.indexOf("&count=")),a.searchResultsArea.append('<div class="oo-more-results">').find("div.oo-more-results").append('<a href="#" class="oo-more-results-link">Show more results</a>').find("a.oo-more-results-link").click(function(){$("div.oo-result").length&&$("div.oo-result").velocity("fadeOut",500),$("div.oo-venue").length&&$("div.oo-venue").velocity("fadeOut",500),$(this).velocity("fadeOut",500,function(){a.searchResultsArea.html(spinner.el).children(".spinner").css("display","none").velocity("fadeIn",500);var b=a.markers.length;for(h=0;b>h;h+=1)google.maps.event.clearListeners(a.markers[h].marker,"click");a.getResponse(a.nextPage)})})),a.removeMarkers(),a.centerMap();var k=[],l=a.records.length;for(h=0;l>h;h+=1)if(-1===k.indexOf(a.records[h].coordinatesUniqueId)){k.push(a.records[h].coordinatesUniqueId);var m=new google.maps.Marker({map:a.map,animation:google.maps.Animation.DROP,position:a.records[h].coordinates});a.markers.push({marker:m,uniqueId:a.records[h].coordinatesUniqueId,siteName:a.records[h].siteName}),a.records[h].marker=a.markers[a.markers.length-1].marker,a.markers[a.markers.length-1].infoWindow=new google.maps.InfoWindow({content:'<p style="text-align:center; margin: 0; padding: 0;  white-space: nowrap;">'+a.records[h].venue+"</p>",maxWidth:300,disableAutoPan:!0})}else for(var n=a.markers.length,o=0;n>o;o+=1)if(a.markers[o].uniqueId===a.records[h].coordinatesUniqueId){a.records[h].marker=a.markers[o].marker;break}for(i=a.markers.length,h=0;i>h;h+=1)google.maps.event.addListener(a.markers[h].marker,"click",a.bindEvents(h)),google.maps.event.addListener(a.markers[h].infoWindow,"closeclick",a.infoWindowCloseClicked(h));$(".oo-venue-title").click(function(){var a=$(this);a.siblings(".oo-results-container").eq(0).hasClass("velocity-animating")||("true"===a.attr("data-hidden")?(a.children(".icon-arrow-minus").addClass("icon-open"),a.siblings(".oo-results-container").velocity("slideDown",{duration:500,easing:"easeInOutCubic",complete:function(){a.attr("data-hidden","false")}})):(a.children(".icon-arrow-minus").removeClass("icon-open"),a.siblings(".oo-results-container").velocity("slideUp",{duration:500,easing:"easeInOutCubic",complete:function(){a.attr("data-hidden","true")}})))}),$("div.oo-venue-title").on("keyup",function(a){var b=a.keyCode||a.which;13==b&&$(this).click()})})}},o=ooSearch;o.init(),o.searchButton.click(function(){o.animateElements($(window).width()>=640?!1:!0)}),o.searchAgainButton.click(function(){var a=o.markers.length;for(i=0;i<a;i+=1)google.maps.event.clearListeners(o.markers[i].marker,"click");o.animateElementsBack($(window).width()>=640?!1:!0),o.removeMarkers(),o.map.panTo(new google.maps.LatLng(51.2088793,.4261792)),o.map.setZoom(10)}),o.searchInputs.on("keyup",function(a){var b=a.keyCode||a.which;13==b&&o.searchButton.click()}),$(document).ready(function(){var a={lines:11,length:10,width:3,radius:8,corners:1,rotate:0,direction:1,color:"#000",speed:1,trail:60,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"50%",left:"50%"};spinner=new Spinner(a).spin()});var ooSearch={markers:[],map:{},records:[],init:function(){Array.prototype.indexOf||(Array.prototype.indexOf=function(a){var b=this.length>>>0,c=Number(arguments[1])||0;for(c=0>c?Math.ceil(c):Math.floor(c),0>c&&(c+=b);b>c;c++)if(c in this&&this[c]===a)return c;return-1}),this.searchContainer=$("div.oo-container"),this.searchButton=$("button.oo-search"),this.searchResultsArea=$("div.oo-output"),this.searchAgainButton=$("button.oo-search-again"),this.searchInputs=$("input.oo-input"),ooSearch.loadMap()},loadMap:function(){var a=[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]}];ooSearch.map=new google.maps.Map(document.getElementById("oo-map"),{zoom:10,center:new google.maps.LatLng(51.2088793,.4261792),mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:!0,styles:a,scrollwheel:!1})},bindEvents:function(a){var b=ooSearch;return function(){if(b.clearInfoWindows(),this.getAnimation())this.setAnimation(null),b.markers[a].infoWindow.close();else{b.stopMarkerAnimation(),this.setAnimation(google.maps.Animation.BOUNCE),b.markers[a].infoWindow.open(b.map,b.markers[a].marker);for(var c=!1,d=0;d<b.records.length;d+=1)b.records[d].coordinatesUniqueId===b.markers[a].uniqueId&&($(".oo-venue-title").not(b.records[d].div.parent().siblings(".oo-venue-title")).each(function(){"true"!==$(this).attr("data-hidden")&&$(this).click()}),"true"===b.records[d].div.parent().siblings(".oo-venue-title").attr("data-hidden")&&b.records[d].div.parent().siblings(".oo-venue-title").click(),c||(b.records[d].div.parent().parent().velocity("scroll",{container:b.searchResultsArea,duration:500,easing:"easeInOutCubic"}),c=!0));b.getNewMapCentre(this.getPosition(),250,0)}}},infoWindowCloseClicked:function(){return function(){o.clearInfoWindows(),o.stopMarkerAnimation()}},clearInfoWindows:function(){for(var a=ooSearch,b=a.markers.length,c=0;b>c;c+=1)a.markers[c].infoWindow.close()},stopMarkerAnimation:function(){var a=ooSearch;for(len=a.markers.length,i=0;i<len;i+=1)a.markers[i].marker.setAnimation(null)},addMarkers:function(){},removeMarkers:function(){var a=ooSearch,b=a.markers.length;for(i=0;i<b;i++)a.markers[i].marker.setMap(null);a.markers=[]},animateElements:function(){var a=ooSearch;a.searchContainer.children("h2").velocity("fadeOut",500),a.searchContainer.children("input").velocity("fadeOut",500),a.searchContainer.children("button").velocity("fadeOut",500,function(){a.searchContainer.removeClass("oo-search-window-active"),a.searchContainer.addClass("oo-results-window-active"),$("div.oo-output-container").velocity("fadeIn",500),$("div.oo-output").velocity("fadeIn",500),a.searchResultsArea.css("display","block").html(spinner.el).children(".spinner").css("display","none").velocity("fadeIn",500,function(){a.getResponse()})})},animateElementsBack:function(){var a=ooSearch;$("div.oo-venue").length&&$("div.oo-venue").velocity("fadeOut",500),$("div.oo-output").length&&$("div.oo-output").velocity("fadeOut",500),$("div.oo-result").length&&$("div.oo-result").velocity("fadeOut",500),$("div.oo-no-result").length&&$("div.oo-no-result").velocity("fadeOut",500),$("div.oo-more-results").length&&$("div.oo-more-results").velocity("fadeOut",500),$("div.oo-output-container").velocity("fadeOut",500,function(){a.searchContainer.removeClass("oo-results-window-active"),a.searchContainer.addClass("oo-search-window-active"),a.searchContainer.children("input").val(""),a.searchContainer.children("h2").velocity("fadeIn",500),a.searchContainer.children("input").velocity("fadeIn",500,function(){a.searchContainer.children("input:first").focus(),a.searchContainer.children("button").velocity("fadeIn",500)})})},getNewMapCentre:function(a,b,c){var d=ooSearch,e=d.map.getProjection().fromLatLngToPoint(a instanceof google.maps.LatLng?a:d.map.getCenter()),f=new google.maps.Point(("number"==typeof b?b:0)/Math.pow(2,d.map.getZoom())||0,("number"==typeof c?c:0)/Math.pow(2,d.map.getZoom())||0);d.map.panTo(d.map.getProjection().fromPointToLatLng(new google.maps.Point(e.x-f.x,e.y+f.y)))},centerMap:function(){for(var a=ooSearch,b=new google.maps.LatLngBounds,c=a.records.length,d=0;c>d;d+=1)b.extend(a.records[d].coordinates);a.map.fitBounds(b);var e=a.map.getZoom();a.map.setZoom(e>12?12:e),a.getNewMapCentre(b.getCenter(),250,0)},getResponse:function(a){var b="https://api.openobjects.com/rest/v1/kent/records?key=cd6fc53d-7751-4bd3-804c-90f1dfc6bef5&query=%2Bservice_type:event",c=$("input.oo-query").val(),d=$("input.oo-location").val();""!==c&&null!==c&&" "!==c&&(c=encodeURIComponent(c),b+="+%2B"+c),""!==d&&null!==d&&" "!==d&&(b+="&spatialLocation="+d,b+="&spatialRadius=5"),b+="&count=10",b+="&sortType=field&sortOrder=0&sortField=venue_name",a&&(b+="&startIndex="+a);try{this.yql="http://query.yahooapis.com/v1/public/yql?q="+encodeURIComponent('select * from xml where url="'+b+'"')+"&format=xml&callback=?"}catch(e){alert("error")}ooSearch.site=b,ooSearch.processResponse()},addLinks:function(a){return function(){window.location.href=ooSearch.records[a].url}},processResponse:function(){var a=ooSearch;$.getJSON(a.yql,function(b){var c=$.parseXML(b.results[0]),d=$(c),e=d.find("record"),f=e.length;if(a.searchResultsArea.html(""),a.nextPage=null,!f)return a.searchResultsArea.append('<div class="oo-no-result">No results found. Please <a href="#" class="oo-try-searching-again">try another search</a>.</div>').css("display","none").velocity("fadeIn",500),void $("a.oo-try-searching-again").click(function(){$("button.oo-search-again").click()});a.records=[];var g=[],h=0;if(e.each(function(){if(!($(this).find("location_postcode__latitude__stored").length&&$(this).find("location_postcode__longitude__stored").length&&$(this).find("venue_name").length))return!0;if(a.records.push({}),a.records[h].recordId=$(this).find("id").text(),a.records[h].url="http://search3.openobjects.com/kb5/kent/directory/event.page?id="+a.records[h].recordId,a.records[h].lat=$(this).find("location_postcode__latitude__stored"),a.records[h].lng=$(this).find("location_postcode__longitude__stored"),a.records[h].lat.length&&a.records[h].lng.length){a.records[h].lat=parseFloat(a.records[h].lat.text()),a.records[h].lng=parseFloat(a.records[h].lng.text());var b=(a.records[h].lat+a.records[h].lng).toString(),c=new google.maps.LatLng(a.records[h].lat,a.records[h].lng);a.records[h].coordinates=c,a.records[h].coordinatesUniqueId=b}a.records[h].venue=$(this).find("venue_name").text(),a.records[h].venueId=a.records[h].venue.replace(/ /g,"-").replace(/,/g,"").replace(/\./g,"").replace(/\(/g,"").replace(/\)/g,"").replace(/&/g,"").replace(/\'/g,"").replace(/[1-9]/g,""),a.records[h].title=$(this).find("title").text(),a.records[h].description=$(this).find("description").text()?$(this).find("description").text().replace("<p>","").replace("</p>","").replace("<span>","").replace("</span>","").replace("<div>","").replace("</div>",""):"No description available.",a.records[h].siteName=$(this).find("venue_name").text(),g.push('<div class="oo-result oo-record-'+h+'"><p class="oo-title"><a href="'+a.records[h].url+'">'+a.records[h].title+'</a></p><p class="oo-description">'+a.records[h].description+"</p></div>"),h++}),!a.records.length)return a.searchResultsArea.append('<div class="oo-no-result">No results found. Please <a href="#" class="oo-try-searching-again">try another search</a>.</div>').css("display","none").velocity("fadeIn",500),void $("a.oo-try-searching-again").click(function(){$("button.oo-search-again").click()});a.venues=[];for(var i=a.records.length,h=0;i>h;h+=1){var j;j=$("html").hasClass("lt-ie9")?!0:!1,a.searchResultsArea.find("div."+a.records[h].venueId).length||(a.venues.push(a.records[h].venueId),a.searchResultsArea.append(j?'<div class="oo-venue '+a.records[h].venueId+'"><div class="oo-venue-title" tabindex="0">'+a.records[h].venue+'<div class="icon-arrow-minus-ie8 icon-open"></div></div><div class="oo-results-container"></div></div>':'<div class="oo-venue '+a.records[h].venueId+'"><div class="oo-venue-title" tabindex="0">'+a.records[h].venue+'<div class="icon-arrow-minus icon-open"></div></div><div class="oo-results-container"></div></div>')),a.searchResultsArea.find("div."+a.records[h].venueId).find("div.oo-results-container").append(g[h]),a.records[h].div=a.searchResultsArea.find("div.oo-record-"+h),a.records[h].div.hide()}a.searchResultsArea.find("div.oo-result").velocity("fadeIn",500),d.find("nextPage").length&&(a.nextPage=d.find("nextPage").text(),a.nextPage=a.nextPage.substring(a.nextPage.indexOf("startIndex=")+11,a.nextPage.indexOf("&count=")),a.searchResultsArea.append('<div class="oo-more-results">').find("div.oo-more-results").append('<a href="#" class="oo-more-results-link">Show more results</a>').find("a.oo-more-results-link").click(function(){$("div.oo-result").length&&$("div.oo-result").velocity("fadeOut",500),$("div.oo-venue").length&&$("div.oo-venue").velocity("fadeOut",500),$(this).velocity("fadeOut",500,function(){a.searchResultsArea.html(spinner.el).children(".spinner").css("display","none").velocity("fadeIn",500);var b=a.markers.length;for(h=0;b>h;h+=1)google.maps.event.clearListeners(a.markers[h].marker,"click");a.getResponse(a.nextPage)})})),a.removeMarkers(),a.centerMap();var k=[],l=a.records.length;for(h=0;l>h;h+=1)if(-1===k.indexOf(a.records[h].coordinatesUniqueId)){k.push(a.records[h].coordinatesUniqueId);var m=new google.maps.Marker({map:a.map,animation:google.maps.Animation.DROP,position:a.records[h].coordinates});a.markers.push({marker:m,uniqueId:a.records[h].coordinatesUniqueId,siteName:a.records[h].siteName}),a.records[h].marker=a.markers[a.markers.length-1].marker,a.markers[a.markers.length-1].infoWindow=new google.maps.InfoWindow({content:'<p style="text-align:center; margin: 0; padding: 0;  white-space: nowrap;">'+a.records[h].venue+"</p>",maxWidth:300,disableAutoPan:!0})}else for(var n=a.markers.length,o=0;n>o;o+=1)if(a.markers[o].uniqueId===a.records[h].coordinatesUniqueId){a.records[h].marker=a.markers[o].marker;break}for(i=a.markers.length,h=0;i>h;h+=1)google.maps.event.addListener(a.markers[h].marker,"click",a.bindEvents(h)),google.maps.event.addListener(a.markers[h].infoWindow,"closeclick",a.infoWindowCloseClicked(h));$(".oo-venue-title").click(function(){var a=$(this);a.siblings(".oo-results-container").eq(0).hasClass("velocity-animating")||("true"===a.attr("data-hidden")?(a.children(".icon-arrow-minus").addClass("icon-open"),a.siblings(".oo-results-container").velocity("slideDown",{duration:500,easing:"easeInOutCubic",complete:function(){a.attr("data-hidden","false")}})):(a.children(".icon-arrow-minus").removeClass("icon-open"),a.siblings(".oo-results-container").velocity("slideUp",{duration:500,easing:"easeInOutCubic",complete:function(){a.attr("data-hidden","true")}})))}),$("div.oo-venue-title").on("keyup",function(a){var b=a.keyCode||a.which;13==b&&$(this).click()})})}},o=ooSearch;o.init(),o.searchButton.click(function(){o.animateElements($(window).width()>=640?!1:!0)}),o.searchAgainButton.click(function(){var a=o.markers.length;for(i=0;i<a;i+=1)google.maps.event.clearListeners(o.markers[i].marker,"click");o.animateElementsBack($(window).width()>=640?!1:!0),o.removeMarkers(),o.map.panTo(new google.maps.LatLng(51.2088793,.4261792)),o.map.setZoom(10)}),o.searchInputs.on("keyup",function(a){var b=a.keyCode||a.which;13==b&&o.searchButton.click()}),$(document).ready(function(){var a={lines:11,length:10,width:3,radius:8,corners:1,rotate:0,direction:1,color:"#000",speed:1,trail:60,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"50%",left:"50%"};spinner=new Spinner(a).spin()});var ooSearch={markers:[],map:{},records:[],init:function(){Array.prototype.indexOf||(Array.prototype.indexOf=function(a){var b=this.length>>>0,c=Number(arguments[1])||0;for(c=0>c?Math.ceil(c):Math.floor(c),0>c&&(c+=b);b>c;c++)if(c in this&&this[c]===a)return c;return-1}),this.searchContainer=$("div.oo-container"),this.searchButton=$("button.oo-search"),this.searchResultsArea=$("div.oo-output"),this.searchAgainButton=$("button.oo-search-again"),this.searchInputs=$("input.oo-input"),ooSearch.loadMap()},loadMap:function(){var a=[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]}];ooSearch.map=new google.maps.Map(document.getElementById("oo-map"),{zoom:10,center:new google.maps.LatLng(51.2088793,.4261792),mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:!0,styles:a,scrollwheel:!1})},bindEvents:function(a){var b=ooSearch;return function(){if(b.clearInfoWindows(),this.getAnimation())this.setAnimation(null),b.markers[a].infoWindow.close();else{b.stopMarkerAnimation(),this.setAnimation(google.maps.Animation.BOUNCE),b.markers[a].infoWindow.open(b.map,b.markers[a].marker);for(var c=!1,d=0;d<b.records.length;d+=1)b.records[d].coordinatesUniqueId===b.markers[a].uniqueId&&($(".oo-venue-title").not(b.records[d].div.parent().siblings(".oo-venue-title")).each(function(){"true"!==$(this).attr("data-hidden")&&$(this).click()}),"true"===b.records[d].div.parent().siblings(".oo-venue-title").attr("data-hidden")&&b.records[d].div.parent().siblings(".oo-venue-title").click(),c||(b.records[d].div.parent().parent().velocity("scroll",{container:b.searchResultsArea,duration:500,easing:"easeInOutCubic"}),c=!0));b.getNewMapCentre(this.getPosition(),250,0)}}},infoWindowCloseClicked:function(){return function(){o.clearInfoWindows(),o.stopMarkerAnimation()}},clearInfoWindows:function(){for(var a=ooSearch,b=a.markers.length,c=0;b>c;c+=1)a.markers[c].infoWindow.close()},stopMarkerAnimation:function(){var a=ooSearch;for(len=a.markers.length,i=0;i<len;i+=1)a.markers[i].marker.setAnimation(null)},addMarkers:function(){},removeMarkers:function(){var a=ooSearch,b=a.markers.length;for(i=0;i<b;i++)a.markers[i].marker.setMap(null);a.markers=[]},animateElements:function(){var a=ooSearch;a.searchContainer.children("h2").velocity("fadeOut",500),a.searchContainer.children("input").velocity("fadeOut",500),a.searchContainer.children("button").velocity("fadeOut",500,function(){a.searchContainer.removeClass("oo-search-window-active"),a.searchContainer.addClass("oo-results-window-active"),$("div.oo-output-container").velocity("fadeIn",500),$("div.oo-output").velocity("fadeIn",500),a.searchResultsArea.css("display","block").html(spinner.el).children(".spinner").css("display","none").velocity("fadeIn",500,function(){a.getResponse()})})},animateElementsBack:function(){var a=ooSearch;$("div.oo-venue").length&&$("div.oo-venue").velocity("fadeOut",500),$("div.oo-output").length&&$("div.oo-output").velocity("fadeOut",500),$("div.oo-result").length&&$("div.oo-result").velocity("fadeOut",500),$("div.oo-no-result").length&&$("div.oo-no-result").velocity("fadeOut",500),$("div.oo-more-results").length&&$("div.oo-more-results").velocity("fadeOut",500),$("div.oo-output-container").velocity("fadeOut",500,function(){a.searchContainer.removeClass("oo-results-window-active"),a.searchContainer.addClass("oo-search-window-active"),a.searchContainer.children("input").val(""),a.searchContainer.children("h2").velocity("fadeIn",500),a.searchContainer.children("input").velocity("fadeIn",500,function(){a.searchContainer.children("input:first").focus(),a.searchContainer.children("button").velocity("fadeIn",500)})})},getNewMapCentre:function(a,b,c){var d=ooSearch,e=d.map.getProjection().fromLatLngToPoint(a instanceof google.maps.LatLng?a:d.map.getCenter()),f=new google.maps.Point(("number"==typeof b?b:0)/Math.pow(2,d.map.getZoom())||0,("number"==typeof c?c:0)/Math.pow(2,d.map.getZoom())||0);d.map.panTo(d.map.getProjection().fromPointToLatLng(new google.maps.Point(e.x-f.x,e.y+f.y)))},centerMap:function(){for(var a=ooSearch,b=new google.maps.LatLngBounds,c=a.records.length,d=0;c>d;d+=1)b.extend(a.records[d].coordinates);a.map.fitBounds(b);var e=a.map.getZoom();a.map.setZoom(e>12?12:e),a.getNewMapCentre(b.getCenter(),250,0)},getResponse:function(a){var b="https://api.openobjects.com/rest/v1/kent/records?key=cd6fc53d-7751-4bd3-804c-90f1dfc6bef5&query=%2Bservice_type:event",c=$("input.oo-query").val(),d=$("input.oo-location").val();""!==c&&null!==c&&" "!==c&&(c=encodeURIComponent(c),b+="+%2B"+c),""!==d&&null!==d&&" "!==d&&(b+="&spatialLocation="+d,b+="&spatialRadius=5"),b+="&count=10",b+="&sortType=field&sortOrder=0&sortField=venue_name",a&&(b+="&startIndex="+a);try{this.yql="http://query.yahooapis.com/v1/public/yql?q="+encodeURIComponent('select * from xml where url="'+b+'"')+"&format=xml&callback=?"}catch(e){alert("error")}ooSearch.site=b,ooSearch.processResponse()},addLinks:function(a){return function(){window.location.href=ooSearch.records[a].url}},processResponse:function(){var a=ooSearch;$.getJSON(a.yql,function(b){var c=$.parseXML(b.results[0]),d=$(c),e=d.find("record"),f=e.length;if(a.searchResultsArea.html(""),a.nextPage=null,!f)return a.searchResultsArea.append('<div class="oo-no-result">No results found. Please <a href="#" class="oo-try-searching-again">try another search</a>.</div>').css("display","none").velocity("fadeIn",500),void $("a.oo-try-searching-again").click(function(){$("button.oo-search-again").click()});a.records=[];var g=[],h=0;if(e.each(function(){if(!($(this).find("location_postcode__latitude__stored").length&&$(this).find("location_postcode__longitude__stored").length&&$(this).find("venue_name").length))return!0;if(a.records.push({}),a.records[h].recordId=$(this).find("id").text(),a.records[h].url="http://search3.openobjects.com/kb5/kent/directory/event.page?id="+a.records[h].recordId,a.records[h].lat=$(this).find("location_postcode__latitude__stored"),a.records[h].lng=$(this).find("location_postcode__longitude__stored"),a.records[h].lat.length&&a.records[h].lng.length){a.records[h].lat=parseFloat(a.records[h].lat.text()),a.records[h].lng=parseFloat(a.records[h].lng.text());var b=(a.records[h].lat+a.records[h].lng).toString(),c=new google.maps.LatLng(a.records[h].lat,a.records[h].lng);a.records[h].coordinates=c,a.records[h].coordinatesUniqueId=b}a.records[h].venue=$(this).find("venue_name").text(),a.records[h].venueId=a.records[h].venue.replace(/ /g,"-").replace(/,/g,"").replace(/\./g,"").replace(/\(/g,"").replace(/\)/g,"").replace(/&/g,"").replace(/\'/g,"").replace(/[1-9]/g,""),a.records[h].title=$(this).find("title").text(),a.records[h].description=$(this).find("description").text()?$(this).find("description").text().replace("<p>","").replace("</p>","").replace("<span>","").replace("</span>","").replace("<div>","").replace("</div>",""):"No description available.",a.records[h].siteName=$(this).find("venue_name").text(),g.push('<div class="oo-result oo-record-'+h+'"><p class="oo-title"><a href="'+a.records[h].url+'">'+a.records[h].title+'</a></p><p class="oo-description">'+a.records[h].description+"</p></div>"),h++
}),!a.records.length)return a.searchResultsArea.append('<div class="oo-no-result">No results found. Please <a href="#" class="oo-try-searching-again">try another search</a>.</div>').css("display","none").velocity("fadeIn",500),void $("a.oo-try-searching-again").click(function(){$("button.oo-search-again").click()});a.venues=[];for(var i=a.records.length,h=0;i>h;h+=1){var j;j=$("html").hasClass("lt-ie9")?!0:!1,a.searchResultsArea.find("div."+a.records[h].venueId).length||(a.venues.push(a.records[h].venueId),a.searchResultsArea.append(j?'<div class="oo-venue '+a.records[h].venueId+'"><div class="oo-venue-title" tabindex="0">'+a.records[h].venue+'<div class="icon-arrow-minus-ie8 icon-open"></div></div><div class="oo-results-container"></div></div>':'<div class="oo-venue '+a.records[h].venueId+'"><div class="oo-venue-title" tabindex="0">'+a.records[h].venue+'<div class="icon-arrow-minus icon-open"></div></div><div class="oo-results-container"></div></div>')),a.searchResultsArea.find("div."+a.records[h].venueId).find("div.oo-results-container").append(g[h]),a.records[h].div=a.searchResultsArea.find("div.oo-record-"+h),a.records[h].div.hide()}a.searchResultsArea.find("div.oo-result").velocity("fadeIn",500),d.find("nextPage").length&&(a.nextPage=d.find("nextPage").text(),a.nextPage=a.nextPage.substring(a.nextPage.indexOf("startIndex=")+11,a.nextPage.indexOf("&count=")),a.searchResultsArea.append('<div class="oo-more-results">').find("div.oo-more-results").append('<a href="#" class="oo-more-results-link">Show more results</a>').find("a.oo-more-results-link").click(function(){$("div.oo-result").length&&$("div.oo-result").velocity("fadeOut",500),$("div.oo-venue").length&&$("div.oo-venue").velocity("fadeOut",500),$(this).velocity("fadeOut",500,function(){a.searchResultsArea.html(spinner.el).children(".spinner").css("display","none").velocity("fadeIn",500);var b=a.markers.length;for(h=0;b>h;h+=1)google.maps.event.clearListeners(a.markers[h].marker,"click");a.getResponse(a.nextPage)})})),a.removeMarkers(),a.centerMap();var k=[],l=a.records.length;for(h=0;l>h;h+=1)if(-1===k.indexOf(a.records[h].coordinatesUniqueId)){k.push(a.records[h].coordinatesUniqueId);var m=new google.maps.Marker({map:a.map,animation:google.maps.Animation.DROP,position:a.records[h].coordinates});a.markers.push({marker:m,uniqueId:a.records[h].coordinatesUniqueId,siteName:a.records[h].siteName}),a.records[h].marker=a.markers[a.markers.length-1].marker,a.markers[a.markers.length-1].infoWindow=new google.maps.InfoWindow({content:'<p style="text-align:center; margin: 0; padding: 0;  white-space: nowrap;">'+a.records[h].venue+"</p>",maxWidth:300,disableAutoPan:!0})}else for(var n=a.markers.length,o=0;n>o;o+=1)if(a.markers[o].uniqueId===a.records[h].coordinatesUniqueId){a.records[h].marker=a.markers[o].marker;break}for(i=a.markers.length,h=0;i>h;h+=1)google.maps.event.addListener(a.markers[h].marker,"click",a.bindEvents(h)),google.maps.event.addListener(a.markers[h].infoWindow,"closeclick",a.infoWindowCloseClicked(h));$(".oo-venue-title").click(function(){var a=$(this);a.siblings(".oo-results-container").eq(0).hasClass("velocity-animating")||("true"===a.attr("data-hidden")?(a.children(".icon-arrow-minus").addClass("icon-open"),a.siblings(".oo-results-container").velocity("slideDown",{duration:500,easing:"easeInOutCubic",complete:function(){a.attr("data-hidden","false")}})):(a.children(".icon-arrow-minus").removeClass("icon-open"),a.siblings(".oo-results-container").velocity("slideUp",{duration:500,easing:"easeInOutCubic",complete:function(){a.attr("data-hidden","true")}})))}),$("div.oo-venue-title").on("keyup",function(a){var b=a.keyCode||a.which;13==b&&$(this).click()})})}},o=ooSearch;o.init(),o.searchButton.click(function(){o.animateElements($(window).width()>=640?!1:!0)}),o.searchAgainButton.click(function(){var a=o.markers.length;for(i=0;i<a;i+=1)google.maps.event.clearListeners(o.markers[i].marker,"click");o.animateElementsBack($(window).width()>=640?!1:!0),o.removeMarkers(),o.map.panTo(new google.maps.LatLng(51.2088793,.4261792)),o.map.setZoom(10)}),o.searchInputs.on("keyup",function(a){var b=a.keyCode||a.which;13==b&&o.searchButton.click()}),$(document).ready(function(){var a={lines:11,length:10,width:3,radius:8,corners:1,rotate:0,direction:1,color:"#000",speed:1,trail:60,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"50%",left:"50%"};spinner=new Spinner(a).spin()});var ooSearch={markers:[],map:{},records:[],init:function(){Array.prototype.indexOf||(Array.prototype.indexOf=function(a){var b=this.length>>>0,c=Number(arguments[1])||0;for(c=0>c?Math.ceil(c):Math.floor(c),0>c&&(c+=b);b>c;c++)if(c in this&&this[c]===a)return c;return-1}),this.searchContainer=$("div.oo-container"),this.searchButton=$("button.oo-search"),this.searchResultsArea=$("div.oo-output"),this.searchAgainButton=$("button.oo-search-again"),this.searchInputs=$("input.oo-input"),ooSearch.loadMap()},loadMap:function(){var a=[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]}];ooSearch.map=new google.maps.Map(document.getElementById("oo-map"),{zoom:10,center:new google.maps.LatLng(51.2088793,.4261792),mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:!0,styles:a,scrollwheel:!1})},bindEvents:function(a){var b=ooSearch;return function(){if(b.clearInfoWindows(),this.getAnimation())this.setAnimation(null),b.markers[a].infoWindow.close();else{b.stopMarkerAnimation(),this.setAnimation(google.maps.Animation.BOUNCE),b.markers[a].infoWindow.open(b.map,b.markers[a].marker);for(var c=!1,d=0;d<b.records.length;d+=1)b.records[d].coordinatesUniqueId===b.markers[a].uniqueId&&($(".oo-venue-title").not(b.records[d].div.parent().siblings(".oo-venue-title")).each(function(){"true"!==$(this).attr("data-hidden")&&$(this).click()}),"true"===b.records[d].div.parent().siblings(".oo-venue-title").attr("data-hidden")&&b.records[d].div.parent().siblings(".oo-venue-title").click(),c||(b.records[d].div.parent().parent().velocity("scroll",{container:b.searchResultsArea,duration:500,easing:"easeInOutCubic"}),c=!0));b.getNewMapCentre(this.getPosition(),250,0)}}},infoWindowCloseClicked:function(){return function(){o.clearInfoWindows(),o.stopMarkerAnimation()}},clearInfoWindows:function(){for(var a=ooSearch,b=a.markers.length,c=0;b>c;c+=1)a.markers[c].infoWindow.close()},stopMarkerAnimation:function(){var a=ooSearch;for(len=a.markers.length,i=0;i<len;i+=1)a.markers[i].marker.setAnimation(null)},addMarkers:function(){},removeMarkers:function(){var a=ooSearch,b=a.markers.length;for(i=0;i<b;i++)a.markers[i].marker.setMap(null);a.markers=[]},animateElements:function(){var a=ooSearch;a.searchContainer.children("h2").velocity("fadeOut",500),a.searchContainer.children("input").velocity("fadeOut",500),a.searchContainer.children("button").velocity("fadeOut",500,function(){a.searchContainer.removeClass("oo-search-window-active"),a.searchContainer.addClass("oo-results-window-active"),$("div.oo-output-container").velocity("fadeIn",500),$("div.oo-output").velocity("fadeIn",500),a.searchResultsArea.css("display","block").html(spinner.el).children(".spinner").css("display","none").velocity("fadeIn",500,function(){a.getResponse()})})},animateElementsBack:function(){var a=ooSearch;$("div.oo-venue").length&&$("div.oo-venue").velocity("fadeOut",500),$("div.oo-output").length&&$("div.oo-output").velocity("fadeOut",500),$("div.oo-result").length&&$("div.oo-result").velocity("fadeOut",500),$("div.oo-no-result").length&&$("div.oo-no-result").velocity("fadeOut",500),$("div.oo-more-results").length&&$("div.oo-more-results").velocity("fadeOut",500),$("div.oo-output-container").velocity("fadeOut",500,function(){a.searchContainer.removeClass("oo-results-window-active"),a.searchContainer.addClass("oo-search-window-active"),a.searchContainer.children("input").val(""),a.searchContainer.children("h2").velocity("fadeIn",500),a.searchContainer.children("input").velocity("fadeIn",500,function(){a.searchContainer.children("input:first").focus(),a.searchContainer.children("button").velocity("fadeIn",500)})})},getNewMapCentre:function(a,b,c){var d=ooSearch,e=d.map.getProjection().fromLatLngToPoint(a instanceof google.maps.LatLng?a:d.map.getCenter()),f=new google.maps.Point(("number"==typeof b?b:0)/Math.pow(2,d.map.getZoom())||0,("number"==typeof c?c:0)/Math.pow(2,d.map.getZoom())||0);d.map.panTo(d.map.getProjection().fromPointToLatLng(new google.maps.Point(e.x-f.x,e.y+f.y)))},centerMap:function(){for(var a=ooSearch,b=new google.maps.LatLngBounds,c=a.records.length,d=0;c>d;d+=1)b.extend(a.records[d].coordinates);a.map.fitBounds(b);var e=a.map.getZoom();a.map.setZoom(e>12?12:e),a.getNewMapCentre(b.getCenter(),250,0)},getResponse:function(a){var b="https://api.openobjects.com/rest/v1/kent/records?key=cd6fc53d-7751-4bd3-804c-90f1dfc6bef5&query=%2Bservice_type:event",c=$("input.oo-query").val(),d=$("input.oo-location").val();""!==c&&null!==c&&" "!==c&&(c=encodeURIComponent(c),b+="+%2B"+c),""!==d&&null!==d&&" "!==d&&(b+="&spatialLocation="+d,b+="&spatialRadius=5"),b+="&count=10",b+="&sortType=field&sortOrder=0&sortField=venue_name",a&&(b+="&startIndex="+a);try{this.yql="http://query.yahooapis.com/v1/public/yql?q="+encodeURIComponent('select * from xml where url="'+b+'"')+"&format=xml&callback=?"}catch(e){alert("error")}ooSearch.site=b,ooSearch.processResponse()},addLinks:function(a){return function(){window.location.href=ooSearch.records[a].url}},processResponse:function(){var a=ooSearch;$.getJSON(a.yql,function(b){var c=$.parseXML(b.results[0]),d=$(c),e=d.find("record"),f=e.length;if(a.searchResultsArea.html(""),a.nextPage=null,!f)return a.searchResultsArea.append('<div class="oo-no-result">No results found. Please <a href="#" class="oo-try-searching-again">try another search</a>.</div>').css("display","none").velocity("fadeIn",500),void $("a.oo-try-searching-again").click(function(){$("button.oo-search-again").click()});a.records=[];var g=[],h=0;if(e.each(function(){if(!($(this).find("location_postcode__latitude__stored").length&&$(this).find("location_postcode__longitude__stored").length&&$(this).find("venue_name").length))return!0;if(a.records.push({}),a.records[h].recordId=$(this).find("id").text(),a.records[h].url="http://search3.openobjects.com/kb5/kent/directory/event.page?id="+a.records[h].recordId,a.records[h].lat=$(this).find("location_postcode__latitude__stored"),a.records[h].lng=$(this).find("location_postcode__longitude__stored"),a.records[h].lat.length&&a.records[h].lng.length){a.records[h].lat=parseFloat(a.records[h].lat.text()),a.records[h].lng=parseFloat(a.records[h].lng.text());var b=(a.records[h].lat+a.records[h].lng).toString(),c=new google.maps.LatLng(a.records[h].lat,a.records[h].lng);a.records[h].coordinates=c,a.records[h].coordinatesUniqueId=b}a.records[h].venue=$(this).find("venue_name").text(),a.records[h].venueId=a.records[h].venue.replace(/ /g,"-").replace(/,/g,"").replace(/\./g,"").replace(/\(/g,"").replace(/\)/g,"").replace(/&/g,"").replace(/\'/g,"").replace(/[1-9]/g,""),a.records[h].title=$(this).find("title").text(),a.records[h].description=$(this).find("description").text()?$(this).find("description").text().replace("<p>","").replace("</p>","").replace("<span>","").replace("</span>","").replace("<div>","").replace("</div>",""):"No description available.",a.records[h].siteName=$(this).find("venue_name").text(),g.push('<div class="oo-result oo-record-'+h+'"><p class="oo-title"><a href="'+a.records[h].url+'">'+a.records[h].title+'</a></p><p class="oo-description">'+a.records[h].description+"</p></div>"),h++}),!a.records.length)return a.searchResultsArea.append('<div class="oo-no-result">No results found. Please <a href="#" class="oo-try-searching-again">try another search</a>.</div>').css("display","none").velocity("fadeIn",500),void $("a.oo-try-searching-again").click(function(){$("button.oo-search-again").click()});a.venues=[];for(var i=a.records.length,h=0;i>h;h+=1){var j;j=$("html").hasClass("lt-ie9")?!0:!1,a.searchResultsArea.find("div."+a.records[h].venueId).length||(a.venues.push(a.records[h].venueId),a.searchResultsArea.append(j?'<div class="oo-venue '+a.records[h].venueId+'"><div class="oo-venue-title" tabindex="0">'+a.records[h].venue+'<div class="icon-arrow-minus-ie8 icon-open"></div></div><div class="oo-results-container"></div></div>':'<div class="oo-venue '+a.records[h].venueId+'"><div class="oo-venue-title" tabindex="0">'+a.records[h].venue+'<div class="icon-arrow-minus icon-open"></div></div><div class="oo-results-container"></div></div>')),a.searchResultsArea.find("div."+a.records[h].venueId).find("div.oo-results-container").append(g[h]),a.records[h].div=a.searchResultsArea.find("div.oo-record-"+h),a.records[h].div.hide()}a.searchResultsArea.find("div.oo-result").velocity("fadeIn",500),d.find("nextPage").length&&(a.nextPage=d.find("nextPage").text(),a.nextPage=a.nextPage.substring(a.nextPage.indexOf("startIndex=")+11,a.nextPage.indexOf("&count=")),a.searchResultsArea.append('<div class="oo-more-results">').find("div.oo-more-results").append('<a href="#" class="oo-more-results-link">Show more results</a>').find("a.oo-more-results-link").click(function(){$("div.oo-result").length&&$("div.oo-result").velocity("fadeOut",500),$("div.oo-venue").length&&$("div.oo-venue").velocity("fadeOut",500),$(this).velocity("fadeOut",500,function(){a.searchResultsArea.html(spinner.el).children(".spinner").css("display","none").velocity("fadeIn",500);var b=a.markers.length;for(h=0;b>h;h+=1)google.maps.event.clearListeners(a.markers[h].marker,"click");a.getResponse(a.nextPage)})})),a.removeMarkers(),a.centerMap();var k=[],l=a.records.length;for(h=0;l>h;h+=1)if(-1===k.indexOf(a.records[h].coordinatesUniqueId)){k.push(a.records[h].coordinatesUniqueId);var m=new google.maps.Marker({map:a.map,animation:google.maps.Animation.DROP,position:a.records[h].coordinates});a.markers.push({marker:m,uniqueId:a.records[h].coordinatesUniqueId,siteName:a.records[h].siteName}),a.records[h].marker=a.markers[a.markers.length-1].marker,a.markers[a.markers.length-1].infoWindow=new google.maps.InfoWindow({content:'<p style="text-align:center; margin: 0; padding: 0;  white-space: nowrap;">'+a.records[h].venue+"</p>",maxWidth:300,disableAutoPan:!0})}else for(var n=a.markers.length,o=0;n>o;o+=1)if(a.markers[o].uniqueId===a.records[h].coordinatesUniqueId){a.records[h].marker=a.markers[o].marker;break}for(i=a.markers.length,h=0;i>h;h+=1)google.maps.event.addListener(a.markers[h].marker,"click",a.bindEvents(h)),google.maps.event.addListener(a.markers[h].infoWindow,"closeclick",a.infoWindowCloseClicked(h));$(".oo-venue-title").click(function(){var a=$(this);a.siblings(".oo-results-container").eq(0).hasClass("velocity-animating")||("true"===a.attr("data-hidden")?(a.children(".icon-arrow-minus").addClass("icon-open"),a.siblings(".oo-results-container").velocity("slideDown",{duration:500,easing:"easeInOutCubic",complete:function(){a.attr("data-hidden","false")}})):(a.children(".icon-arrow-minus").removeClass("icon-open"),a.siblings(".oo-results-container").velocity("slideUp",{duration:500,easing:"easeInOutCubic",complete:function(){a.attr("data-hidden","true")}})))}),$("div.oo-venue-title").on("keyup",function(a){var b=a.keyCode||a.which;13==b&&$(this).click()})})}},o=ooSearch;o.init(),o.searchButton.click(function(){o.animateElements($(window).width()>=640?!1:!0)}),o.searchAgainButton.click(function(){var a=o.markers.length;for(i=0;i<a;i+=1)google.maps.event.clearListeners(o.markers[i].marker,"click");o.animateElementsBack($(window).width()>=640?!1:!0),o.removeMarkers(),o.map.panTo(new google.maps.LatLng(51.2088793,.4261792)),o.map.setZoom(10)}),o.searchInputs.on("keyup",function(a){var b=a.keyCode||a.which;13==b&&o.searchButton.click()}),$(document).ready(function(){var a={lines:11,length:10,width:3,radius:8,corners:1,rotate:0,direction:1,color:"#000",speed:1,trail:60,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"50%",left:"50%"};spinner=new Spinner(a).spin()});